{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 133, "column": 0}, "map": {"version":3,"sources":["file:///Users/danahmaruk/Desktop/projects/auth/app/api/api.ts"],"sourcesContent":["import axios from 'axios';\n\nexport const api = axios.create({\n  baseURL: 'https://notehub-api.goit.study',\n  withCredentials: true,\n});\n"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,MAAM,kJAAK,CAAC,MAAM,CAAC;IAC9B,SAAS;IACT,iBAAiB;AACnB","debugId":null}},
    {"offset": {"line": 147, "column": 0}, "map": {"version":3,"sources":["file:///Users/danahmaruk/Desktop/projects/auth/app/api/_utils/utils.ts"],"sourcesContent":["export function logErrorResponse(errorObj: unknown): void {\n  const green = '\\x1b[32m';\n  const yellow = '\\x1b[33m';\n  const reset = '\\x1b[0m';\n\n  // Стрелка зелёная, текст жёлтый\n  console.log(`${green}> ${yellow}Error Response Data:${reset}`);\n  console.dir(errorObj, { depth: null, colors: true });\n}\n"],"names":[],"mappings":";;;;AAAO,SAAS,iBAAiB,QAAiB;IAChD,MAAM,QAAQ;IACd,MAAM,SAAS;IACf,MAAM,QAAQ;IAEd,gCAAgC;IAChC,QAAQ,GAAG,CAAC,GAAG,MAAM,EAAE,EAAE,OAAO,oBAAoB,EAAE,OAAO;IAC7D,QAAQ,GAAG,CAAC,UAAU;QAAE,OAAO;QAAM,QAAQ;IAAK;AACpD","debugId":null}},
    {"offset": {"line": 166, "column": 0}, "map": {"version":3,"sources":["file:///Users/danahmaruk/Desktop/projects/auth/app/api/auth/login/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { api } from '../../api';\nimport { cookies } from 'next/headers';\nimport { parse } from 'cookie';\nimport { isAxiosError } from 'axios';\nimport { logErrorResponse } from '../../_utils/utils';\n\nexport async function POST(req: NextRequest) {\n  // Read body once and reuse it\n  const body = await req.json();\n  console.log('Login request body:', { email: body.email, hasPassword: !!body.password });\n  \n  try {\n    const apiRes = await api.post('auth/login', body);\n\n    const cookieStore = await cookies();\n    const setCookie = apiRes.headers['set-cookie'];\n\n    if (setCookie) {\n      const cookieArray = Array.isArray(setCookie) ? setCookie : [setCookie];\n      for (const cookieStr of cookieArray) {\n        // Parse Set-Cookie header manually: \"cookieName=value; Path=/; Max-Age=3600\"\n        // Extract cookie name and value from the first part before semicolon\n        const parts = cookieStr.split(';');\n        const [nameValue] = parts;\n        const [cookieName, cookieValue] = nameValue.split('=').map(s => s.trim());\n        \n        if (!cookieName || !cookieValue) continue;\n        \n        // Parse attributes\n        const parsed = parse(cookieStr);\n        \n        const options: {\n          expires?: Date;\n          path?: string;\n          maxAge?: number;\n          httpOnly?: boolean;\n          secure?: boolean;\n          sameSite?: 'strict' | 'lax' | 'none';\n        } = {\n          expires: parsed.Expires ? new Date(parsed.Expires) : undefined,\n          path: parsed.Path || '/',\n          maxAge: parsed['Max-Age'] ? Number(parsed['Max-Age']) : undefined,\n          httpOnly: true,\n          secure: process.env.NODE_ENV === 'production',\n          sameSite: 'lax',\n        };\n\n        if (cookieName === 'accessToken') {\n          cookieStore.set('accessToken', cookieValue, options);\n          console.log('Login - Set accessToken cookie:', {\n            hasValue: !!cookieValue,\n            valueLength: cookieValue.length,\n            path: options.path,\n            httpOnly: options.httpOnly,\n          });\n        }\n        if (cookieName === 'refreshToken') {\n          cookieStore.set('refreshToken', cookieValue, options);\n          console.log('Login - Set refreshToken cookie:', {\n            hasValue: !!cookieValue,\n            valueLength: cookieValue.length,\n            path: options.path,\n            httpOnly: options.httpOnly,\n          });\n        }\n      }\n\n      console.log('Login - Returning user data:', apiRes.data);\n      return NextResponse.json(apiRes.data, { status: apiRes.status });\n    }\n\n    // If no cookies but API call was successful, still return the data\n    if (apiRes.status >= 200 && apiRes.status < 300) {\n      return NextResponse.json(apiRes.data, { status: apiRes.status });\n    }\n\n    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n  } catch (error) {\n    if (isAxiosError(error)) {\n      logErrorResponse(error.response?.data);\n      const status = error.response?.status || error.status || 500;\n      \n      // Try to extract error message from different possible formats\n      const errorData = error.response?.data;\n      let errorMessage = error.message;\n      \n      if (errorData) {\n        // Try different possible error message fields\n        errorMessage = errorData.message || \n                      errorData.error || \n                      errorData.msg ||\n                      (typeof errorData === 'string' ? errorData : error.message);\n      }\n      \n      console.log('Login error:', {\n        status,\n        errorMessage,\n        errorData,\n      });\n      \n      // If user not found, try to register automatically\n      if (status === 404 || errorMessage?.toLowerCase().includes('not found') || errorMessage?.toLowerCase().includes('user not found')) {\n        try {\n          console.log('User not found, attempting auto-registration...');\n          const registerRes = await api.post('auth/register', body);\n          \n          const cookieStore = await cookies();\n          const setCookie = registerRes.headers['set-cookie'];\n          \n          if (setCookie) {\n            const cookieArray = Array.isArray(setCookie) ? setCookie : [setCookie];\n            for (const cookieStr of cookieArray) {\n              const parts = cookieStr.split(';');\n              const [nameValue] = parts;\n              const [cookieName, cookieValue] = nameValue.split('=').map(s => s.trim());\n              \n              if (!cookieName || !cookieValue) continue;\n              \n              const parsed = parse(cookieStr);\n              const options: {\n                expires?: Date;\n                path?: string;\n                maxAge?: number;\n                httpOnly?: boolean;\n                secure?: boolean;\n                sameSite?: 'strict' | 'lax' | 'none';\n              } = {\n                expires: parsed.Expires ? new Date(parsed.Expires) : undefined,\n                path: parsed.Path || '/',\n                maxAge: parsed['Max-Age'] ? Number(parsed['Max-Age']) : undefined,\n                httpOnly: true,\n                secure: process.env.NODE_ENV === 'production',\n                sameSite: 'lax',\n              };\n              \n              if (cookieName === 'accessToken') {\n                cookieStore.set('accessToken', cookieValue, options);\n              }\n              if (cookieName === 'refreshToken') {\n                cookieStore.set('refreshToken', cookieValue, options);\n              }\n            }\n          }\n          \n          console.log('Auto-registration successful, returning user data');\n          return NextResponse.json(registerRes.data, { status: registerRes.status });\n        } catch (registerError) {\n          console.log('Auto-registration failed:', registerError);\n          // If registration also fails, return original error\n        }\n      }\n      \n      return NextResponse.json(\n        { error: errorMessage, response: errorData },\n        { status }\n      );\n    }\n    logErrorResponse({ message: (error as Error).message });\n    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}